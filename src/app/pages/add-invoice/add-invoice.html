<div class="space-y-4 bg-gray-50 rounded-2xl shadow-sm">
    <!-- üîç Tra c·ª©u h√≥a ƒë∆°n -->
    <section
        class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6 hover:shadow-md transition"
    >
        <header class="mb-5">
            <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                <i class="fa-solid fa-file-invoice text-green-600"></i>
                Tra c·ª©u h√≥a ƒë∆°n
            </h2>
            <p class="text-sm text-gray-500 mt-1">
                Nh·∫≠p th√¥ng tin m√£ h√≥a ƒë∆°n v√† Captcha ƒë·ªÉ tra c·ª©u nhanh.
            </p>
        </header>

        <!-- Captcha -->
        <div class="flex flex-wrap items-center gap-3 mb-4">
            <img
                [src]="captchaSession().captcha_path"
                alt="captcha"
                class="flex-1 h-12 rounded-lg border border-gray-200"
            />
            <button
                (click)="loadCaptcha()"
                class="p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition text-gray-600"
                title="T·∫£i l·∫°i Captcha"
            >
                <fa-icon [icon]="faArrowsRotate"></fa-icon>
            </button>
        </div>

        <!-- Inputs -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <input
                type="text"
                [(ngModel)]="captchaInput"
                placeholder="Nh·∫≠p m√£ Captcha"
                class="input-modern"
            />
            <input
                type="text"
                [(ngModel)]="invoiceCode"
                placeholder="M√£ h√≥a ƒë∆°n"
                class="input-modern"
            />
            <input
                type="text"
                [(ngModel)]="invoiceCT"
                placeholder="M√£ CT"
                class="input-modern sm:col-span-2"
            />
            <button (click)="getInvoiceInfo()" class="btn-primary sm:col-span-2">Tra c·ª©u</button>
        </div>
    </section>

    <!-- üè¨ Ng∆∞·ªùi b√°n -->
    <section
        class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6 hover:shadow-md transition"
    >
        <header class="flex items-center gap-2 mb-4">
            <i class="fa-solid fa-store text-green-600"></i>
            <h2 class="text-lg font-semibold text-gray-800">Ng∆∞·ªùi b√°n</h2>
        </header>

        <div class="grid gap-3">
            <div class="info-card">
                <label>ƒê∆°n v·ªã:</label>
                <span>{{ nban().ten }}</span>
            </div>
            <div class="info-card">
                <label>M√£ s·ªë thu·∫ø:</label>
                <span>{{ nban().mst }}</span>
            </div>
            <div class="info-card">
                <label>ƒê·ªãa ch·ªâ:</label>
                <span>{{ nban().d_chi }}</span>
            </div>
            <div class="info-card">
                <label>ƒêi·ªán tho·∫°i:</label>
                <span>{{ nban().sdt }}</span>
            </div>
        </div>

        <div class="mt-6">
            <h3 class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                <i class="fa-solid fa-code-branch text-emerald-500"></i> Chi nh√°nh
            </h3>
            <div class="grid gap-2">
                @for (tt_khac of nban().tt_khac; track $index) {
                <div class="info-card">
                    <label>{{ tt_khac.t_truong }}:</label>
                    <span>{{ tt_khac.d_lieu }}</span>
                </div>
                }
            </div>
        </div>
    </section>

    <!-- üßæ Danh s√°ch h√†ng h√≥a trong h√≥a ƒë∆°n -->
    <section
        class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6 hover:shadow-md transition"
    >
        <header class="flex items-center justify-between mb-5">
            <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                <i class="fa-solid fa-cart-shopping text-indigo-600"></i>
                Danh s√°ch h√†ng h√≥a trong h√≥a ƒë∆°n
            </h2>
        </header>

        <div class="space-y-3 mb-3">
            @for (item of hhdvus(); track $index) {
            <div
                class="grid grid-cols-1 sm:grid-cols-2 gap-3 p-4 bg-gray-50 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition"
            >
                <input
                    type="text"
                    [(ngModel)]="item.thhdvu"
                    placeholder="T√™n h√†ng"
                    class="input-modern"
                />
                <div class="grid grid-cols-3 gap-2">
                    <input
                        type="number"
                        [(ngModel)]="item.th_tien_sau_lai_suat"
                        class="input-modern col-span-2"
                        placeholder="Gi√°"
                        (input)="onInvoiceInput($event, item)"
                    />
                    <button (click)="removeInvoiceItem(item.id)" class="btn-danger">
                        <fa-icon [icon]="faTrash"></fa-icon>
                    </button>
                </div>
            </div>
            }
        </div>

        <button (click)="addInvoiceItem()" class="btn-success">
            <fa-icon [icon]="faCirclePlus"></fa-icon> Th√™m h√†ng h√≥a
        </button>
    </section>

    <!-- üí∏ H√†ng h√≥a mua ngo√†i h√≥a ƒë∆°n -->
    <section
        class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6 hover:shadow-md transition"
    >
        <header class="flex items-center justify-between mb-5">
            <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                <i class="fa-solid fa-basket-shopping text-emerald-600"></i>
                H√†ng h√≥a mua ngo√†i h√≥a ƒë∆°n
            </h2>
        </header>

        <div class="space-y-3 mb-3">
            @for (item of cashItems(); track $index) {
            <div
                class="grid grid-cols-1 sm:grid-cols-2 gap-3 p-4 bg-gray-50 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition"
            >
                <input
                    type="text"
                    [(ngModel)]="item.name"
                    placeholder="T√™n h√†ng"
                    class="input-modern"
                />
                <div class="grid grid-cols-3 gap-2">
                    <input
                        type="text"
                        [(ngModel)]="item.cash"
                        placeholder="Gi√°"
                        class="input-modern col-span-2"
                        (input)="onCashInput($event, item)"
                    />
                    <button (click)="removeExtraItem(item.id)" class="btn-danger">
                        <fa-icon [icon]="faTrash"></fa-icon>
                    </button>
                </div>
            </div>
            }
        </div>

        <button (click)="addExtraItem()" class="btn-success">
            <fa-icon [icon]="faCirclePlus"></fa-icon> Th√™m h√†ng ngo√†i h√≥a ƒë∆°n
        </button>
    </section>

    <!-- üìÖ Ng√†y + T·ªïng c·ªông -->
    <section
        class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6 hover:shadow-md transition"
    >
        <div class="grid md:grid-cols-2 gap-6 items-start">
            <!-- Ng√†y h√≥a ƒë∆°n -->
            <div>
                <label class="text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                    <i class="fa-regular fa-calendar text-blue-500"></i>
                    Ng√†y h√≥a ƒë∆°n
                </label>
                <input type="date" [(ngModel)]="invoiceDate" class="input-modern" />
            </div>

            <!-- T·ªïng c·ªông -->
            <div class="summary-card">
                <div class="flex justify-between text-sm mb-2">
                    <span>T·ªïng c·ªông (ch∆∞a thu·∫ø):</span>
                    <span class="font-medium text-gray-800">
                        {{ ttoan().tg_tc_thue | number }}
                    </span>
                </div>
                <div class="flex justify-between text-sm mb-2">
                    <span>Thu·∫ø (VAT):</span>
                    <span class="font-medium text-gray-800">
                        {{ ttoan().tg_t_thue | number }}
                    </span>
                </div>
                <div
                    class="flex justify-between font-semibold text-lg text-gray-900 border-t border-gray-200 pt-2"
                >
                    <span>T·ªïng thanh to√°n:</span>
                    <span class="text-green-600">
                        {{ ttoan().tg_tt_tb_so | number }}
                    </span>
                </div>
                <p class="text-sm italic text-gray-500 mt-2">
                    <i class="fa-solid fa-quote-left text-gray-400 mr-1"></i>
                    B·∫±ng ch·ªØ: {{ ttoan().tg_tt_tb_chu }}
                </p>
            </div>
        </div>

        <div class="mt-6">
            <button (click)="saveInvoice()" class="btn-primary w-full">
                <i class="fa-solid fa-save mr-2"></i> L∆∞u h√≥a ƒë∆°n
            </button>
        </div>
    </section>
</div>
